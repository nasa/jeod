<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JEOD: Related Pages</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JEOD
   &#160;<span id="projectnumber">5.2</span>
   </div>
   <div id="projectbrief">JSC Engineering Orbital Dynamics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Related Pages</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock">Here is a list of all related documentation pages:</div><div class="directory">
<table class="directory">
<tr id="row_0_" class="even"><td class="entry"><span style="width:16px;display:inline-block;">&#160;</span><a class="el" href="df/d5b/readme.html" target="_self">README</a></td><td class="desc"><pre class="fragment">==============================================================================
 Notices:

 Copyright Â© 2023 United States Government as represented by the Administrator
 of the National Aeronautics and Space Administration.  All Rights Reserved.


 Disclaimers:

 No Warranty: THE SUBJECT SOFTWARE IS PROVIDED "AS IS" WITHOUT ANY WARRANTY OF
 ANY KIND, EITHER EXPRESSED, IMPLIED, OR STATUTORY, INCLUDING, BUT NOT LIMITED
 TO, ANY WARRANTY THAT THE SUBJECT SOFTWARE WILL CONFORM TO SPECIFICATIONS, ANY
 IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR
 FREEDOM FROM INFRINGEMENT, ANY WARRANTY THAT THE SUBJECT SOFTWARE WILL BE ERROR
 FREE, OR ANY WARRANTY THAT DOCUMENTATION, IF PROVIDED, WILL CONFORM TO THE
 SUBJECT SOFTWARE. THIS AGREEMENT DOES NOT, IN ANY MANNER, CONSTITUTE AN
 ENDORSEMENT BY GOVERNMENT AGENCY OR ANY PRIOR RECIPIENT OF ANY RESULTS,
 RESULTING DESIGNS, HARDWARE, SOFTWARE PRODUCTS OR ANY OTHER APPLICATIONS
 RESULTING FROM USE OF THE SUBJECT SOFTWARE.  FURTHER, GOVERNMENT AGENCY
 DISCLAIMS ALL WARRANTIES AND LIABILITIES REGARDING THIRD-PARTY SOFTWARE,
 IF PRESENT IN THE ORIGINAL SOFTWARE, AND DISTRIBUTES IT "AS IS."

 Waiver and Indemnity:  RECIPIENT AGREES TO WAIVE ANY AND ALL CLAIMS AGAINST THE
 UNITED STATES GOVERNMENT, ITS CONTRACTORS AND SUBCONTRACTORS, AS WELL AS ANY
 PRIOR RECIPIENT.  IF RECIPIENT'S USE OF THE SUBJECT SOFTWARE RESULTS IN ANY
 LIABILITIES, DEMANDS, DAMAGES, EXPENSES OR LOSSES ARISING FROM SUCH USE,
 INCLUDING ANY DAMAGES FROM PRODUCTS BASED ON, OR RESULTING FROM, RECIPIENT'S
 USE OF THE SUBJECT SOFTWARE, RECIPIENT SHALL INDEMNIFY AND HOLD HARMLESS THE
 UNITED STATES GOVERNMENT, ITS CONTRACTORS AND SUBCONTRACTORS, AS WELL AS ANY
 PRIOR RECIPIENT, TO THE EXTENT PERMITTED BY LAW.  RECIPIENT'S SOLE REMEDY FOR
 ANY SUCH MATTER SHALL BE THE IMMEDIATE, UNILATERAL TERMINATION OF THIS
 AGREEMENT.

==============================================================================

September 2024

Contents

1. Overview
2. Acknowledgment
3. Usage
4. Key changes since the last release
5. Known issues
6. Regression testing
7. Change history

================================================================================
1. Overview
================================================================================

This section provides overview information about the Johnson Space Center
Engineering Orbital Dynamics (JEOD) software package.

This note describes the most recent release of JEOD, JEOD 5.2. The primary
objectives for 5.2 release of JEOD were to:

* Resolved FIXME and TODO items in the code (see section 4 for detail)
* Implemented GoogleTest stub and mock classes for unit tests
* Modernization of code using clang-tidy
* Improved code formatting using auto formatting tool.
* Added test cases for alt_pfix and alt_inertial
* API improvements
* Fixed bugs

The key features of this release are highlighted in section 4 below.


The JEOD 5.2 Release
****************************

The release comprises
* Models. The JEOD models provide the functionality needed to represent
  vehicles that translate and rotate in a space environment. The models are
  organized into four main groups: dynamics, environment, interactions, and
  utilities. Each of these four groups corresponds to a subdirectory of the
  JEOD models directory. The immediate subdirectory of each model group
  directory contains exactly one JEOD model. Models are accompanied with
  test artifacts to verify that a model satisfies its requirements. For JEOD
  5.2, there is also an experimental directory containing experimental
  models that are not yet rigorously verified and documented up to typical JEOD
  standards. Users planning to these experimental models should understand the
  risk associated with them and there are currently no plan for documentation
  and verification of these models.

* Test and Analysis Tools. Trick simulations have long been used to test the
  JEOD models. JEOD 5.2 contains Trick-compatible versions of all
  previously existing simulations.

* Training Materials. Getting a picture of how JEOD works by reading the
  overview and model documentation can be tough. The JEOD training materials
  are located in the $JEOD_HOME/docs/Training directory. These materials
  systematically show users how to use JEOD via the course lecture notes,
  lessons covering every extant JEOD model (except the SPICE interface model
  and experimental models) and tutorial exercises of increasing complexity.

* Verification and Validation Simulations. In addition to the model-level
  verification testing, JEOD 5.2 has been tested against best estimate of
  trajectory (BET) data from various orbiting vehicles. These documented
  integrated tests not only demonstrate that JEOD properly models the space
  environment, they also serve as additional examples of how to use JEOD in a
  realistic simulation. Since JEOD 5.0, some BET data were removed from the
  release so that JEOD can be host on Github.com. However, validation result
  are still presented in the top-level JEOD documentation.

* Top-level Documentation. JEOD is well documented from the top-level down.
  The top-level JEOD documentation is the file $JEOD_HOME/docs/JEOD.pdf.
  The dynamic comparison simulation is described in the file
  $JEOD_HOME/verif/SIM_dyncomp/docs/DYNCOMP.pdf.

* Model Documentation. Each model has a model document located in the file
  $JEOD_HOME/models/&lt;model_group&gt;/&lt;model_name&gt;/docs/&lt;model_name&gt;.pdf.

* HTML Pages. The Application Programmer Interface (API) to the JEOD models can
  be viewed by directing a browser to file://$JEOD_HOME/html/jeod/index.html.
  These HTML pages are automatically generated from the JEOD source code by
  doxygen. In addition to displaying the API, the JEOD PDF documentation files
  are accessible through these HTML pages.


================================================================================
2. Acknowledgment
================================================================================
JEOD v5.2 release accepted the following pull requests submitted by GitHub users:

* Title: Change Logging Python Utility to Log "parent/this" Varaibles
  - GitHub User: miwr0
  - URL: https://github.com/nasa/jeod/pull/10


================================================================================
3. Usage
================================================================================

Important Note
*******************************************
According to https://endoflife.date/centos, Centos 7's support cycle is ended
on 2024-06-30. The ended of life impacted the ability to perform CI on CentOS 7.
Therefore, CentOS 7 is no longer actively supported starting JEOD 5.2


Instructions for use in a Trick environment
*******************************************
The JEOD package is first and foremost a package designed for use in simulations
developed with the Trick simulation environment. This release of JEOD 5.2
was tested with Trick 19.7.2, using compiler gcc 4.8.5 on CentOS 7.6, 7.5.0 on
Ubuntu 18.04, 8.5.0 on Oracle Linux 8, and LLVM version 18.1.8 on Mac.

Required environment variables
------------------------------
The following environment variables must be set to use JEOD in conjunction
with the Trick simulation environment.

  JEOD_HOME             The JEOD_HOME environment variable must point to the
                        top-level JEOD directory (i.e., the directory that
                        contains this README_jeod file).

  TRICK_CFLAGS          The TRICK_CFLAGS &amp; TRICK_CXXFLAGS environment variables
  TRICK_CXXFLAGS        must add the JEOD models directory to the include path
                        list. The variable must contain "-I${JEOD_HOME}/models".

  TRICK_HOME            The adjacent list of three additional Trick environment
  TRICK_VER             variables is just a partial list of those required by
  TRICK_HOST_CPU        Trick. Please refer to Trick documentation for details.


It is recommended that the system administrator provide standard shell
scripts that properly set the above environment variables.

Simulation specification and compilation
----------------------------------------
Trick simulations are specified in an S_define file and built using the Trick-
provided trick-CP utility. Please refer to the Trick user manual for a
description of an S_define file and the use of trick-CP.

ER7_Utils
---------
There is no need to separately obtain the ER7_Utils package when JEOD is used
within a Trick environment. ER7_Utils is distributed with Trick as a
third-party package. The trick-CP utility makes the package visible to the
compiler via an include path that begins with "er7_utils/integration".

Required Package
---------
JEOD 5.2 requires installation of swig3 and cmake3


================================================================================
4. Key changes since the last production release (JEOD 5.2)
================================================================================

Resolved FIXME and TODO items in the code
-------------------------
Resolved total of 34 FIXME/TODO items in the code. These include:
- Improved failure messages in DynManager::initialize_model and
  JEODTrick10MemoryInterface::get_name_at_address
- Changed JeodDynBodyIntegrationLoop::add_integrable_object to allow DynBody
  objects without failure
- Added JeodSimulationInterface::Mode to MessageHandler
- Added check for duplicates in DynBodyContraintsSolver::add_attached_constraints
- Added an inheritance diagram to DynBodyInit documentation


Implemented GoogleTest stub and mock classes
-------------------------
Started the implementation of stub and mock classes of some of the models to
work with GoogleTest. These stub and mock classes can also be use for unit
testing of models developed based on the JEOD classes. Stub and mock classes for
the following models are implemented for JEOD v5.2 release. Additional stub and
mock will be implemented in future releases.
* Added partial or complete mock classes for:
  - class MassBody
  - class BodyRefFrame
  - class DynBody
  - class BodyAction
  - class DynManager
  - class DynamicsIntegrationGroup
  - class RefFrame
  - class JeodIntegrationGroup
  - class JeodIntegrationTime
  - class er7_utils::IntegrableObject
  - class er7_utils::IntegrationControls
  - class er7_utils::IntegratorConstructor
  - class MessageHandler
  - class JeodIntegratorInterface
  - class JeodMemoryInterface
  - class JeodSimulationInterface
  - class GravityControls
  - class EphemerisRefFrame
  - class SinglePointEphemeris
* Added ER7 Utils stubs required to compile jeod unit tests:
  - class BaseIntegrationGroup
  - static method Er7UtilsDeletable::delete_instance_internal
  - class IntegrationControls
  - static method IntegratorConstructorFactory::create
  - class IntegratorConstructor
  - class IntegratorResultMergerContainer
  - class LeftQuaternionGeneralizedPositionDerivativeFunctions


Modernization of code using clang-tidy and improved code formatting using ClangFormat
-------------------------
Used clang-tidy to modernize code from older C concepts to more modern C++11
concepts. The main families of options used included bugprone, cppcoreguidelines,
llvm, modernize, performance, and readability.
Improved code formatting using ClangFormat to provide consistent code format.
Implemented formatting check in development CI to enforce formatting standards
in the code


API Improvements
-------------------------
* Improvement in JEOD_MAKE_SIM_INTERFACE
  - Updated to the JEOD_MAKE_SIM_INTERFACE macro that enable the function to be
    used for models that are based on JEOD classes but outside the "jeod" namespace.
* MassBodyInit::allocate_points replaces setting MassBodyInit::num_points and
  MassBodyInit::points using trick.TMM_declare_var_s in input files. Items in
  MassBodyInit::points are now accessed with MassBodyInit::get_mass_point
* All char * have now been converted to std::string
* MET_atmosphere constructor now takes in a reference to time_utc.trunc_julian_time
  and the MET_atmosphere::update_time method has been eliminated.
* Complete conversion from Python 2 to Python 3.


Critical Bug Fixes
-------------------------
- TreeLinks::child_head() and TreeLinks::child_tail() were previously commented
  saying that they returned iterators, when they actually return references.
  This caused a bug that has now been resolved in JEOD v5.1.1 and documented in
  this release.


================================================================================
5. Known issues
================================================================================

The issues known to exist with the JEOD 5.2 release are:

* Non-Trick demonstration.
  The demonstration of the usability of JEOD outside the Trick environment is
  not currently maintained and may not work with this release.

* Trick support.
  JEOD 5.2 is officially tested with Trick 19.7.2 or newer. Backward
  compatibility with older versions of Trick are not guarantee, but most models
  should still work with Trick 19.0 or newer. Users are strongly encouraged to
  upgrade to a newer version of Trick if their project allows.

* Trickified build works for all the regression test sims on CentOS 7,
  Ubuntu 18, Oracle Linux 8, and MacOS with Apple silicon.
  - However, Observed on Mac but could be a cmake version issue (cmake v3.30.3)
    building sims in parallel using TRICKIFIED=1 may cause problems due to cmake
    updating a file despite nothing to update. This does not rebuild any objects
    or libraries but can trigger a re-install of the libraries. A sim starting
    to link in the libjeod.a will end up working with the partially written
    library file and fail to build.
  - The workaround that retains parallel sim build is to set the
    $JEOD_HOME/trickified (ie. chmod -w trickified) directory to read-only after
    the building the jeod library and trickified builds. The make rules will
    recognize the read-only state and only link in the libraries without
    attempting to rebuild.

* Experimental models.
  For this release, there is a directory named $JEOD_HOME/models/experimental.
  It contains new models that have NOT been rigorously verified or
  documented up to typical JEOD standards. Users planning to utilize these
  experimental models should understand the risks associated with them and
  that there are currently NO plans for documentation and verification of
  these models.


================================================================================
6. Regression testing
================================================================================

Several regression tests are provided with this release. These regression tests
are used internally to verify that the release behaves as expected. These tests
are not necessarily the same tests used for validation. External users can use
these tests to verify that their installation of JEOD yields results comparable
to those supplied with the release. The regression tests are located in

* $JEOD_HOME/verif
  This directory contains the simulations used to verify that JEOD operates
  correctly as a whole.

* $JEOD_HOME/sims
   This directory contains an abbreviated Apollo simulation.

* The verif subdirectories found in the JEOD model directories. Some of these
  contain simulations supplied with regression test data. Most models contain
  verification simulations or unit tests.

  Note: A small number of these model verification tests fail by design.
  All simulation runs that intentionally fail have fail or FAIL embedded
  in the simulation RUN directory name.

Caveats:
* All regression test data supplied with the release were generated using a
  64-bit machine running CentOS 7.5 and compiled with gcc 4.8.5 and Oracle
  Linux 8 with gcc 8.5.0. Users should not expect exact numeric matches when
  using a different machine architecture, a different operating system, or a
  different compiler.

  An extreme example of this is the RUN_euler case of the
  utils/integration/verif/SIM_integ sim. The stability of the Euler method
  is such that the results of this case are "confusion-limited"; that is, the
  results for this case exhibit chaotic system-dependent behavior. Note that
  use of the Euler integration method is generally not recommended.

* Regression test scripts are provided in JEOD v5.2. These scripts are used
  internally to verify the release behaves as expected. Users planning to use
  these scripts for their own regression test are free to modify the script
  to fit their needs. However, no support will be provided for these regression
  test scripts.



================================================================================
7. Change history
================================================================================

****************************
JEOD 5.2, September 2024
****************************
* Changes to models.
  - Total of 34 FIXME/TODO items in the code were resolved in this release. These
    include changes in:
    # Improved failure messages in DynManager::initialize_model and
      JEODTrick10MemoryInterface::get_name_at_address
    # Changed JeodDynBodyIntegrationLoop::add_integrable_object to allow DynBody
      objects without failure
    # Added JeodSimulationInterface::Mode to MessageHandler
    # Added check for duplicates in DynBodyContraintsSolver::add_attached_constraints
    # Added an inheritance diagram to DynBodyInit documentation
  - Fixed bug in TreeLinks. The issue was resolved in JEOD v5.1.1 release.
    Documenting in JEOD v5.2 release note.

* Changes to sims and unit tests.
  - Added test cases for alt_pfix and alt_inertial frames
  - Implemented stub and mock classes that work with GoogleTest for unit test

* Changes to Documentation
  - Fixed metrics table in some model documentations
  - JEOD documentations were updated for the JEOD 5.2 release.

* Changes to tools.
  - Modernization of code using clang-tidy
  - Formatting of the code using ClangFormat to provide consistent formatting
  - Implemented formatting check in CI to enforce formatting standard


****************************
JEOD 5.1, July 2023
****************************
* Changes to models.
  - Added support for Moon Mean Earth (Moon_ME) body fixed frame.
  - Added kinematic attachment capability.
  - Improved ease of use for calculating derivative states for a child body.
  - Improved checkpoint-restart for standard STL containers.
  - Improved ephemeris data generation using mako template.

* Changes to sims and unit tests.
  - Fixed SIM_spice.
  - Completed SIM_dyncomp_structure.
  - Added test cases to verify kinematic attachment.
  - Improved checkpoint-restart verification sim to test dynamically allocated
    objects.
  - Fixed training solution sims.

* Changes to Documentation
  - JEOD documentations were updated for the JEOD 5.1 release.

* Changes to tools.
  - Implemented static analysis job (CppCheck and Flawfinder) in CI.


****************************
JEOD 5.0, August 2022
****************************
* Changes to models.
  - removed some best estimated data (BED) from actual space mission from the
    software.
  - removed TCAM model and Atmosphere Interface models.
  - Updated checkpoint tag for standard STL containers.
  - Updated unit specification for angle.
  - Included new set of gravitational coefficients for Moon from GRAIL.

* Changes to sims and unit tests.
  - Removed SIM_Grace
  - Removed RUN_champ, RUN_envisat, RUN_iss, RUN_lageos, and RUN_tdrs from
    SIM_Earth_Moon
  - Training solution sims were updated to JEOD v5.0

* Changes to Documentation
  - Training documentations were to JEOD v5.0
  - Top-level JEOD documentation and some model documentations were updated
    such that they only contains information that are publicly releasable.
  - JEOD documentations were updated for the 5.0 release
  - Removed programmer information from the source code to prepare for open
    source

* Changes to tools.
  - Using CppCheck and Flawfinder for static analysis
  - Using Lcov for code coverage.
  - Implemented a manual code coverage job in CI
</pre> </td></tr>
<tr id="row_1_"><td class="entry"><span style="width:16px;display:inline-block;">&#160;</span><a class="el" href="d8/d3b/dyncomp_sdefine.html" target="_self">Dynamic Comparison S_define</a></td><td class="desc"><pre class="fragment">//=============================================================================
// Notices:
//
// Copyright Â© 2023 United States Government as represented by the Administrator
// of the National Aeronautics and Space Administration.  All Rights Reserved.
//
//
// Disclaimers:
//
// No Warranty: THE SUBJECT SOFTWARE IS PROVIDED "AS IS" WITHOUT ANY WARRANTY OF
// ANY KIND, EITHER EXPRESSED, IMPLIED, OR STATUTORY, INCLUDING, BUT NOT LIMITED
// TO, ANY WARRANTY THAT THE SUBJECT SOFTWARE WILL CONFORM TO SPECIFICATIONS, ANY
// IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR
// FREEDOM FROM INFRINGEMENT, ANY WARRANTY THAT THE SUBJECT SOFTWARE WILL BE ERROR
// FREE, OR ANY WARRANTY THAT DOCUMENTATION, IF PROVIDED, WILL CONFORM TO THE
// SUBJECT SOFTWARE. THIS AGREEMENT DOES NOT, IN ANY MANNER, CONSTITUTE AN
// ENDORSEMENT BY GOVERNMENT AGENCY OR ANY PRIOR RECIPIENT OF ANY RESULTS,
// RESULTING DESIGNS, HARDWARE, SOFTWARE PRODUCTS OR ANY OTHER APPLICATIONS
// RESULTING FROM USE OF THE SUBJECT SOFTWARE.  FURTHER, GOVERNMENT AGENCY
// DISCLAIMS ALL WARRANTIES AND LIABILITIES REGARDING THIRD-PARTY SOFTWARE,
// IF PRESENT IN THE ORIGINAL SOFTWARE, AND DISTRIBUTES IT "AS IS."
//
// Waiver and Indemnity:  RECIPIENT AGREES TO WAIVE ANY AND ALL CLAIMS AGAINST THE
// UNITED STATES GOVERNMENT, ITS CONTRACTORS AND SUBCONTRACTORS, AS WELL AS ANY
// PRIOR RECIPIENT.  IF RECIPIENT'S USE OF THE SUBJECT SOFTWARE RESULTS IN ANY
// LIABILITIES, DEMANDS, DAMAGES, EXPENSES OR LOSSES ARISING FROM SUCH USE,
// INCLUDING ANY DAMAGES FROM PRODUCTS BASED ON, OR RESULTING FROM, RECIPIENT'S
// USE OF THE SUBJECT SOFTWARE, RECIPIENT SHALL INDEMNIFY AND HOLD HARMLESS THE
// UNITED STATES GOVERNMENT, ITS CONTRACTORS AND SUBCONTRACTORS, AS WELL AS ANY
// PRIOR RECIPIENT, TO THE EXTENT PERMITTED BY LAW.  RECIPIENT'S SOLE REMEDY FOR
// ANY SUCH MATTER SHALL BE THE IMMEDIATE, UNILATERAL TERMINATION OF THIS
// AGREEMENT.
//
//=============================================================================
//
//
//===========================TRICK HEADER=====================
// PURPOSE:
//=============================================================================
// This simulation provides a reference implementation that can be used for
// comparison to other orbital dynamics implementations.  It is intended to
// provide a reference set for dynamics comparison.
//
// This simulation models a single vehicle in orbit around the Earth.  There
// are many adjustable configuration parameters that can be used to test out
// a suite of test cases with specific behavior.  These test cases form the
// basis for simulation to simulation comparison.
//
//          sys - Trick runtime executive and data recording routines
//         time - Representations of different clocks used in the sim
//     dynamics - Orbital dynamics
//          env - Environment: ephemeris, gravity
//          sun - Sun planetary model
//         moon - Moon planetary model
//        earth - Earth planetary model
//       vehicle - Space vehicle dynamics model
//
//=============================================================================

// Define job calling intervals
#define LOW_RATE_ENV 60.00 // Low-rate environment update interval
#define DYNAMICS 0.03125   // Vehicle and plantary dynamics interval (32Hz)

// Include the default system classes:
#include "sim_objects/default_trick_sys.sm"

// Include the default jeod object
#include "jeod_sys.sm"

// Define the phase initialization priorities.
#include "default_priority_settings.sm"

// Set up desired time types and include the JEOD time S_module
#define TIME_MODEL_UT1
#define TIME_MODEL_UTC
#define TIME_MODEL_TT
#define TIME_MODEL_GMST
#define TIME_CALENDAR_UPDATE_INTERVAL DYNAMICS
#include "jeod_time.sm"

#include "dynamics.sm"
#include "environment.sm"
#include "moon_basic.sm"
#include "sun_basic.sm"
#define JEOD_OVERRIDE_GGM02C_WITH_GEMT1
#include "earth_GGM05C_MET_RNP.sm"

/*****************************************************************************
Vehicle Sim Object
Purpose:(Provides the vehicle object)
*****************************************************************************/
// Include headers for classes that this class contains:
##include "dynamics/body_action/include/dyn_body_init_lvlh_rot_state.hh"
##include "dynamics/derived_state/include/euler_derived_state.hh"
##include "dynamics/derived_state/include/lvlh_derived_state.hh"
##include "dynamics/derived_state/include/orb_elem_derived_state.hh"
##include "dynamics/dyn_body/include/force.hh"
##include "dynamics/dyn_body/include/torque.hh"
##include "interactions/gravity_torque/include/gravity_torque.hh"
##include "environment/atmosphere/base_atmos/include/atmosphere.hh"
##include "interactions/aerodynamics/include/aero_drag.hh"

// Include default data classes:
##include "interactions/aerodynamics/data/include/aero_model.hh"

// include the base class defintion.
#include "Base/vehicle_atmosphere.sm"
class VehicleSimObject : public VehicleAtmSimObject
{
public:
    jeod::DynBodyInitLvlhRotState lvlh_init;
    jeod::EulerDerivedState euler;
    jeod::LvlhDerivedState lvlh;
    jeod::EulerDerivedState lvlh_euler;
    jeod::OrbElemDerivedState orb_elem;
    jeod::Force force_extern;
    jeod::Torque torque_extern;
    jeod::GravityTorque grav_torque;
    jeod::SphericalHarmonicsGravityControls earth_grav_control;
    jeod::SphericalHarmonicsGravityControls moon_grav_control;
    jeod::SphericalHarmonicsGravityControls sun_grav_control;
    jeod::AerodynamicDrag aero_drag;

    // Instances for default data:
    jeod::AerodynamicDrag_aero_model_default_data aero_drag_default_data;

    // Constructor
    VehicleSimObject(jeod::DynManager &amp; dyn_manager_, jeod::METAtmosphere &amp; atmos_, jeod::WindVelocity &amp; wind_)
        : VehicleAtmSimObject(dyn_manager_, atmos_, wind_)

    {
        //
        // Default data jobs
        //
        ("default_data") aero_drag_default_data.initialize(&amp;aero_drag);

        //
        // Initialization jobs
        //
        P_DYN("initialization") euler.initialize(dyn_body, dyn_manager);
        P_DYN("initialization") lvlh.initialize(dyn_body, dyn_manager);
        P_DYN("initialization") lvlh_euler.initialize(lvlh.lvlh_frame, dyn_body, dyn_manager);
        P_DYN("initialization") orb_elem.initialize(dyn_body, dyn_manager);
        ("initialization") euler.update();
        ("initialization") pfix.update();
        ("initialization") lvlh.update();
        ("initialization") lvlh_euler.update();
        ("initialization") orb_elem.update();
        ("initialization") grav_torque.initialize(dyn_body);
        //
        // Environment class jobs
        //
        (DYNAMICS, "environment") euler.update();
        (DYNAMICS, "environment") lvlh.update();
        (DYNAMICS, "environment") lvlh_euler.update();
        (DYNAMICS, "environment") orb_elem.update();
        //
        // Derivative class jobs
        //
        P_BODY("derivative")
        aero_drag.aero_drag(dyn_body.composite_body.state.trans.velocity,
                            &amp;atmos_state,
                            dyn_body.structure.state.rot.T_parent_this,
                            dyn_body.mass.composite_properties.mass,
                            dyn_body.mass.composite_properties.position);
        P_PGRAV("derivative") grav_torque.update();
    }

    VehicleSimObject(const VehicleSimObject &amp;) = delete;
    VehicleSimObject &amp; operator=(const VehicleSimObject &amp;) = delete;
};
VehicleSimObject vehicle(dynamics.dyn_manager, earth.atmos, earth.wind_velocity);

##include "dynamics/body_action/include/body_attach_aligned.hh"

class DynBodySimObject : public Trick::SimObject
{
public:
    jeod::DynBody dyn_body;
    jeod::DynManager * dyn_manager_ptr;
    double external_force[3]; //!&lt; trick_units(N)

    DynBodySimObject()
        : dyn_manager_ptr(nullptr)
    {
        dyn_body.collect.collect_effector_forc.push_back(jeod::CollectForce::create(external_force));
        P_ENV("initialization") dyn_body.initialize_model(*dyn_manager_ptr);
    }
};

class AttachToFrameHelper : public Trick::SimObject
{
public:
    AttachToFrameHelper(jeod::DynBody &amp; bodyIn)
        : body(bodyIn)
    {
    }

    double position[3];
    double rotation[3][3];

    void attach_wrap_child_parent_pos_rot(const std::string &amp; child_frame, const std::string &amp; parent_frame)
    {
        body.attach_to_frame(child_frame.c_str(), parent_frame.c_str(), position, rotation);
    }

    void attach_wrap_pos_rot_parent(jeod::RefFrame &amp; parentIn)
    {
        body.attach_to_frame(position, rotation, parentIn);
    }

    AttachToFrameHelper(const AttachToFrameHelper &amp;) = delete;
    AttachToFrameHelper &amp; operator=(const AttachToFrameHelper &amp;) = delete;

private:
    jeod::DynBody &amp; body;
};

AttachToFrameHelper attach_to_frame_helper(vehicle.dyn_body);

// Note: Moved to create_connections for restart testing
// vcollect vehicle.dyn_body.collect.collect_effector_forc jeod::CollectForce::create {
//   vehicle.force_extern
//};
vcollect vehicle.dyn_body.collect.collect_environ_forc jeod::CollectForce::create{};
vcollect vehicle.dyn_body.collect.collect_no_xmit_forc jeod::CollectForce::create{vehicle.aero_drag.aero_force};
vcollect vehicle.dyn_body.collect.collect_effector_torq jeod::CollectTorque::create{vehicle.torque_extern};
vcollect vehicle.dyn_body.collect.collect_environ_torq jeod::CollectTorque::create{};
vcollect vehicle.dyn_body.collect.collect_no_xmit_torq jeod::CollectTorque::create{vehicle.aero_drag.aero_torque,
                                                                                   vehicle.grav_torque.torque};

void create_connections()
{
    vehicle.dyn_body.collect.collect_effector_forc.push_back(jeod::CollectForce::create(vehicle.force_extern));
}

IntegLoop sim_integ_loop(DYNAMICS) dynamics, earth, vehicle;
</pre> </td></tr>
<tr id="row_2_" class="even"><td class="entry"><span style="width:16px;display:inline-block;">&#160;</span><a class="el" href="d7/d19/initialization_dotfile.html" target="_self">initialization.dot</a></td><td class="desc"><pre class="fragment">digraph G {
   label = "Trick Initialization Job Dependencies";
   compound = true;
   center=true;
   style=rounded;
   color=white;
   pencolor=black;

   node [fontname="Helvetica",fontsize=11];
   edge [fontname="Helvetica",fontsize=11,arrowhead=vee];

   subgraph cluster_P_TIME {
      label = "P_TIME";

      // Nodes
      TimeManager__register_converter [label="TimeManager::register_converter"];
      TimeManager__initialize [label="TimeManager::initialize"];
      TimeManager__register_time [label="TimeManager::register_time"];
      TimeStandard__calendar_update [label="TimeStandard::calendar_update"];
      // Edges for ordering  
      {rank=same;TimeManager__initialize;TimeStandard__calendar_update;};
   }

   subgraph cluster_P_MNGR {
      label = "P_MNGR";

      // Nodes
      DynManager__initialize_model [label="DynManager::initialize_model"];
   }
//   {rank=same;TimeManager__initialize;DynManager__initialize_model;};
   subgraph cluster_P_ENV {
      label = "P_ENV";

      // Nodes
        
      subgraph cluster_gravity {
	 label="";
	 De4xxEphemeris__initialize_model [label="De4xxEphemeris::initialize_model"];
	 GravityManager__initialize_model [label="GravityManager::initialize_model"];      
	 GravityBody__initialize_body [label="GravityBody::initialize_body"];
	 GravityManager__add_grav_source [label="GravityManager::add_grav_source"];
	 Planet__register_model [label="Planet::register_model"];
	 RNPJ2000__initialize [label="RNPJ2000::initialize"];
	 RNPJ2000__update_rnp [label="RNPJ2000::update_rnp"];
         pencolor=white;
	 // Edges for ordering  
         GravityManager__initialize_model -&gt; GravityBody__initialize_body [style="invis"];	 
      }
      
      subgraph cluster_dynbody{
      	 label="";
	 METAtmosphere__update_time [label="METAtmosphere::update_time"];
	 DynBody__initialize_model [label="DynBody::initialize_model"];
	 PolarMotionJ2000__initialize [label="PolarMotionJ2000::initialize"];
	 NutationJ2000__initialize [label="NutationJ2000::initialize"];
	 pencolor=white;
	 // Edges for ordering  
	 METAtmosphere__update_time -&gt; PolarMotionJ2000__initialize [style="invis"];	
	 PolarMotionJ2000__initialize -&gt; NutationJ2000__initialize [style="invis"];
	 NutationJ2000__initialize -&gt; DynBody__initialize_model [style="invis"];
      }

   }

   subgraph cluster_P_BODY {
      label = "P_BODY";

      // Nodes
      DynManager__initialize_simulation [label="DynManager::initialize_simulation"];
      Planet__initialize [label="Planet::initialize"];
   }

   subgraph cluster_P_DYN {
      label = "P_DYN";

      // Nodes
      EulerDerivedState__initialize [label="EulerDerivedState::initialize"];
      LvlhDerivedState__initialize [label="LvlhDerivedState::initialize"];
      PlanetaryDerivedState__initialize [label="PlanetaryDerivedState::initialize"];
      OrbElemDerivedState__initialize [label="OrbElemDerivedState::initialize"];
      // Edges for ordering
      EulerDerivedState__initialize -&gt; LvlhDerivedState__initialize [style="invis"];
      LvlhDerivedState__initialize -&gt; OrbElemDerivedState__initialize [style="invis"];
      OrbElemDerivedState__initialize -&gt; PlanetaryDerivedState__initialize [style="invis"];
   }
   
   subgraph state_update {   
      label="";
      EulerDerivedState__update [label="EulerDerivedState::update"];      
      LvlhDerivedState__update [label="LvlhDerivedState::update"];      
      
      OrbElemDerivedState__update [label="OrbElemDerivedState::update"];
      // Edges for ordering
      EulerDerivedState__update -&gt; LvlhDerivedState__update [style="invis"];
      LvlhDerivedState__update -&gt; OrbElemDerivedState__update [style="invis"];
      pencolor=white;
   }

   {rank=same;EulerDerivedState__update;EulerDerivedState__initialize;};

   // Nodes
   GravityTorque__initialize [label="GravityTorque::initialize"];
   
   PlanetaryDerivedState__update [label="PlanetaryDerivedState::update"];
   METAtmosphere__update_state [label="METAtmosphere::update_state"];
   METAtmosphere__update_wind [label="METAtmosphere::update_wind"];
   METAtmosphere__update_state -&gt; METAtmosphere__update_wind [style="invis"];

   // Edges
   TimeManager__register_converter -&gt; TimeManager__initialize;
   TimeManager__register_time -&gt; TimeManager__initialize;
   TimeManager__initialize -&gt; DynManager__initialize_model;
   TimeManager__initialize -&gt; DynManager__initialize_simulation;
   TimeManager__initialize -&gt; De4xxEphemeris__initialize_model;
   TimeManager__initialize -&gt; RNPJ2000__update_rnp -&gt; DynManager__initialize_simulation;
   TimeManager__initialize -&gt; TimeStandard__calendar_update -&gt; METAtmosphere__update_time -&gt; METAtmosphere__update_state;

   EulerDerivedState__initialize -&gt; EulerDerivedState__update;
   LvlhDerivedState__initialize -&gt; LvlhDerivedState__update;
   OrbElemDerivedState__initialize -&gt; OrbElemDerivedState__update;
   PlanetaryDerivedState__initialize -&gt; PlanetaryDerivedState__update;
   PlanetaryDerivedState__update -&gt; METAtmosphere__update_state;
   PlanetaryDerivedState__update -&gt; METAtmosphere__update_wind;

   NutationJ2000__initialize -&gt; RNPJ2000__update_rnp;
   PolarMotionJ2000__initialize -&gt; RNPJ2000__update_rnp;

   DynBody__initialize_model -&gt; EulerDerivedState__initialize;
   DynBody__initialize_model -&gt; LvlhDerivedState__initialize;
   DynBody__initialize_model -&gt; PlanetaryDerivedState__initialize;
   DynBody__initialize_model -&gt; OrbElemDerivedState__initialize;

   DynManager__initialize_model -&gt; DynBody__initialize_model -&gt; DynManager__initialize_simulation;
   DynManager__initialize_model -&gt; De4xxEphemeris__initialize_model -&gt; DynManager__initialize_simulation;
   DynManager__initialize_model -&gt; GravityManager__initialize_model -&gt; GravityTorque__initialize;

   De4xxEphemeris__initialize_model -&gt; GravityManager__initialize_model;

   GravityBody__initialize_body -&gt; GravityManager__add_grav_source;
   GravityManager__add_grav_source -&gt; Planet__register_model;
   GravityManager__add_grav_source -&gt; Planet__initialize;

   Planet__register_model -&gt; Planet__initialize -&gt; DynManager__initialize_simulation;
   Planet__register_model -&gt; RNPJ2000__initialize -&gt; RNPJ2000__update_rnp;

}
</pre> </td></tr>
<tr id="row_3_"><td class="entry"><span style="width:16px;display:inline-block;">&#160;</span><a class="el" href="d2/d8b/scheduled_dotfile.html" target="_self">scheduled.dot</a></td><td class="desc"><pre class="fragment">digraph G {
   label = "Trick Scheduled Job Dependencies";
   compound = true;
   center=true;
   style=rounded;
   color=white;
   pencolor=black;

   node [fontname="Helvetica",fontsize=11];
   edge [fontname="Helvetica",fontsize=11,arrowhead=vee];

   // Nodes 
   
   
   subgraph cluster0 {   
      node [group="time"];
      label="";
      RNPJ2000__update_rnp [label="RNPJ2000::update_rnp"];      
      TimeStandard__calendar_update [label="TimeStandard::calendar_update"];
      METAtmosphere__update_time [label="METAtmosphere::update_time"];
      AtmosphereState__update_state [label="AtmosphereState::update_state"];
      // Edges for ordering
      RNPJ2000__update_rnp -&gt; TimeStandard__calendar_update [style="invis"];
      pencolor=white;
   } 
   
   subgraph cluster1 {   
      node [group="manager"];
      label="";
      TimeManager__update [label="TimeManager::update"];
      DynManager__update_ephemerides [label="DynManager::update_ephemerides"];
      AtmosphereState__update_wind [label="AtmosphereState::update_wind"];
      // Edges for ordering
      DynManager__update_ephemerides -&gt; AtmosphereState__update_wind [style="invis"];
      pencolor=white;
   }    

   subgraph cluster2 {   
      node [group="state"];
      label="";
      EulerDerivedState__update [label="EulerDerivedState::update"];      
      LvlhDerivedState__update [label="LvlhDerivedState::update"];      
      PlanetaryDerivedState__update [label="PlanetaryDerivedState::update"];
      OrbElemDerivedState__update [label="OrbElemDerivedState::update"];
      // Edges for ordering
      EulerDerivedState__update -&gt; LvlhDerivedState__update [style="invis"];
      LvlhDerivedState__update -&gt; OrbElemDerivedState__update [style="invis"];
      OrbElemDerivedState__update -&gt; PlanetaryDerivedState__update [style="invis"];
      pencolor=white;
   }

   {rank="same"; RNPJ2000__update_rnp;TimeManager__update;EulerDerivedState__update;};
   
   

   
   // Edges
   TimeManager__update -&gt; TimeStandard__calendar_update;
   TimeManager__update -&gt; DynManager__update_ephemerides;
   TimeManager__update -&gt; RNPJ2000__update_rnp;
   TimeManager__update -&gt; EulerDerivedState__update;
   TimeManager__update -&gt; PlanetaryDerivedState__update;
   TimeManager__update -&gt; LvlhDerivedState__update;
   TimeManager__update -&gt; OrbElemDerivedState__update;

   DynManager__update_ephemerides -&gt; OrbElemDerivedState__update;
   DynManager__update_ephemerides -&gt; LvlhDerivedState__update;
   DynManager__update_ephemerides -&gt; PlanetaryDerivedState__update;
   DynManager__update_ephemerides -&gt; EulerDerivedState__update;

   TimeStandard__calendar_update -&gt; METAtmosphere__update_time;

   PlanetaryDerivedState__update -&gt; AtmosphereState__update_state;
   PlanetaryDerivedState__update -&gt; AtmosphereState__update_wind;

   METAtmosphere__update_time -&gt; AtmosphereState__update_state;

}
</pre> </td></tr>
<tr id="row_4_" class="even"><td class="entry"><span style="width:16px;display:inline-block;">&#160;</span><a class="el" href="dc/dc5/derivative_dotfile.html" target="_self">derivative.dot</a></td><td class="desc"><pre class="fragment">digraph G {
   label = "Trick Derivative Job Dependencies";
   compound = true;
   center=true;
   style=rounded;
   color=white;
   pencolor=black;

   node [fontname="Helvetica",fontsize=11];
   edge [fontname="Helvetica",fontsize=11,arrowhead=vee];

   subgraph cluster_P_BODY {
      label = "P_BODY";
      labeljust = l;
      // Nodes
      AerodynamicDrag__aero_drag [label="AerodynamicDrag::aero_drag"];
   }

   DynManager__compute_derivatives [label="DynManager::compute_derivatives"];
   
   subgraph cluster_P_ENV {
      label = "P_ENV";
      labeljust = l;
      // Nodes
      RNPJ2000__update_axial_rotation [label="RNPJ2000::update_axial_rotation"];
   }

   subgraph cluster_grav {
      label = "";
      subgraph cluster_P_GRAV {
	 label = "P_GRAV";
         labeljust = l;
	 // Nodes
	 DynManager__gravitation [label="DynManager::gravitation"];
      }
      subgraph cluster_P_PGRAV {
	 label = "P_PGRAV";
         labeljust = l;
	 // Nodes
	 GravityTorque__update [label="GravityTorque::update"];
      }
      pencolor=white;
   }
   {rank="same"; DynManager__gravitation;};

   // Edges
   GravityTorque__update -&gt; DynManager__compute_derivatives;
   RNPJ2000__update_axial_rotation -&gt; DynManager__compute_derivatives;
   AerodynamicDrag__aero_drag -&gt; DynManager__compute_derivatives;
   DynManager__gravitation -&gt; GravityTorque__update;



}
</pre> </td></tr>
<tr id="row_5_"><td class="entry"><span style="width:16px;display:inline-block;">&#160;</span><a class="el" href="df/dcc/topleveldocs.html" target="_self">Toplevel Documents</a></td><td class="desc">The main documentation for JEOD is in the form of pdf files </td></tr>
<tr id="row_6_" class="even"><td class="entry"><span style="width:16px;display:inline-block;">&#160;</span><a class="el" href="d3/dc7/modeldocs.html" target="_self">Model Documentation</a></td><td class="desc">Model documentation, organized by model type, are: </td></tr>
<tr id="row_7_"><td class="entry"><span style="width:16px;display:inline-block;">&#160;</span><a class="el" href="dd/da0/todo.html" target="_self">Todo List</a></td><td class="desc"></td></tr>
</table>
</div><!-- directory -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
